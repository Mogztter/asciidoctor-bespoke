-
  var partitionTitle = function(title) {
    // FIXME replace ':' with document.getAttribute('title-separator')
    return Opal.Asciidoctor.Document.Title['$new'](title, Opal.hash({'separator': ':'}));
  };

- var _bg_img_block = node.findBy({context: 'image', role: 'canvas'})[0]
- var _bg_img = typeof _bg_img_block !== 'undefined' ? node.getImageUri(_bg_img_block.getAttribute('target')) : ''
- var _bg_size = typeof _bg_img_block !== 'undefined' ? 'cover' : ''
- var _class = typeof _bg_img_block !== 'undefined' ? 'image' : node.getRoles()
- var _style = typeof _bg_img_block !== 'undefined' ? 'background-image: url(' + _bg_img + '); background-size: ' + _bg_size : '' // REMIND Interpolation doesn't work when using a variable
- var _title_obj = partitionTitle(node.getTitle())
section(id=_id class=_class style=_style data-title=(node.getAttribute('reftext')) data-bespoke-backdrop=(node.getAttribute('backdrop-role')))
  if !node.getTitle().startsWith('!') && !node.isOption('conceal')
    if _title_obj.hasSubtitle()
      header
        h2!=_title_obj.getMain()
        h3!=_title_obj.getSubtitle()
    else
      h2(class=node.isOption('fit') ? 'fit' : '')=_title_obj.getMain()
  !=node.getContent()
